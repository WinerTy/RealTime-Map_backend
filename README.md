# RealTime-map API

![Python](https://img.shields.io/badge/Python-3.13-3776AB?style=flat&logo=python)
![FastAPI](https://img.shields.io/badge/FastAPI-0.115.0-009688?style=flat&logo=fastapi)
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-336791?style=flat&logo=postgresql)

---

## Table of Contents

- [1. About The Project](#1-about-the-project)
- [2. Tech Stack](#2-tech-stack)
- [3. Features](#3-features)
- [4. Getting Started with Docker](#4-getting-started-with-docker)
    - [Prerequisites](#prerequisites)
    - [Setup and Configuration](#setup-and-configuration)
    - [Running the Application](#running-the-application)

---

## 1. About The Project (Для чего сделан)

**RealTime-Map** — это backend для геосоциальной платформы, которая позволяет людям создавать временные метки на карте и взаимодействовать с происходящим вокруг них в режиме реального времени.

### Зачем это нужно?

Представьте, что вы можете оставить "цифровой след" в любом месте — отметить интересное событие, встречу, находку или предупреждение, которое будет видно другим людям поблизости. Это может быть:

- Спонтанное мероприятие или встреча
- Интересное место, о котором стоит узнать
- Важное уведомление для района
- Точка для общения с людьми рядом

Каждая метка существует ограниченное время (от 12 часов до недели), что делает платформу живой и актуальной — здесь нет устаревшей информации.

### Как это работает?

**Для пользователей:**
1. Откройте карту и посмотрите, что происходит вокруг вас прямо сейчас
2. Создайте метку в нужном месте с фото, категорией и длительностью
3. Общайтесь через комментарии и реакции
4. Зарабатывайте опыт за активность и повышайте уровень
5. Получайте уведомления о новых метках рядом с вами в реальном времени

**Под капотом:**
- Метки находятся мгновенно благодаря оптимизированным геопространственным запросам
- Уведомления приходят в реальном времени через постоянное соединение с сервером
- Система опыта и уровней мотивирует пользователей быть активными
- Все работает быстро даже при большом количестве пользователей

### Философия разработки

Проект разрабатывается с фокусом на:

- **Производительность**: Полностью асинхронная архитектура для обработки тысяч одновременных подключений
- **Масштабируемость**: Модульная структура, кеширование, фоновые задачи
- **Качество кода**: Строгая типизация, чистая архитектура, адаптер-паттерн для гибкости
- **Современность**: Использование последних версий Python, FastAPI, SQLAlchemy 2.0, Pydantic v2
- **Геопространственная эффективность**: Оптимизированные запросы через PostGIS и геохеширование

### Текущий статус

Проект находится в активной разработке. Недавно была проведена крупная рефакторинг-инициатива по переходу на Adapter Pattern для улучшения гибкости работы с данными. Основные модули реализованы и функционируют:

- ✅ Создание и управление метками с геопозиционированием
- ✅ Система аутентификации и профилей пользователей
- ✅ Real-time уведомления через WebSocket
- ✅ Комментарии и реакции
- ✅ Gamification (опыт, уровни, награды за действия)
- ✅ Подписки и монетизация через YooKassa
- ✅ Модерация и система банов
- ✅ Админ-панель для управления контентом

Платформа готова к тестированию и дальнейшему развитию функционала.

---

## 2. Tech Stack (Стэк)

Проект построен на современном высокопроизводительном Python-стеке, обеспечивающем масштабируемость и надежность.

* **Язык:** [Python 3.13](https://www.python.org/)
* **API Framework:** [FastAPI](https://fastapi.tiangolo.com/) — высокопроизводительная асинхронная разработка
* **База данных:** [PostgreSQL](https://www.postgresql.org/) с расширением [PostGIS](https://postgis.net/) для геопространственных запросов
* **Кеширование:** [Redis](https://redis.io/) для кеша и брокера сообщений
* **Фоновые задачи:** [Celery](https://docs.celeryq.dev/) для асинхронной обработки длительных операций
* **Real-time:** [Socket.IO](https://socket.io/) для мгновенной отправки обновлений клиентам
* **Валидация:** [Pydantic](https://docs.pydantic.dev/) для валидации данных, сериализации и управления настройками
* **Менеджер пакетов:** [uv](https://github.com/astral-sh/uv) для быстрой установки зависимостей

---

## 3. Ключевые возможности

**Функциональные возможности:**
* Геолокационные метки с фотографиями и категориями
* Автоматическое удаление устаревших меток (12-168 часов жизни)
* Система комментариев с вложенными ответами и реакциями
* Встроенный чат для общения между пользователями
* Gamification: опыт, уровни, награды за активность
* Подписки с расширенными возможностями
* Модерация контента и система банов
* Панель администратора для управления платформой

**Технические особенности:**
* Полностью асинхронная архитектура для высокой производительности
* Строгая типизация всего кодабаза для надежности и удобства разработки
* Эффективные геопространственные запросы через PostGIS
* Фоновая обработка тяжелых операций для отзывчивости API
* Real-time уведомления через WebSocket
* Автоматическая интерактивная документация API (Swagger UI и ReDoc)

---

## 4. Быстрый старт с Docker

Самый простой способ запустить проект локально — использовать Docker и Docker Compose. Это автоматически настроит API-сервер, базу данных, Redis и Celery worker.

### Требования

* [Docker](https://www.docker.com/get-started)
* [Docker Compose](https://docs.docker.com/compose/install/) (обычно включен в Docker Desktop)
* [Git](https://git-scm.com/)

### Настройка и конфигурация

1. **Клонируйте репозиторий**
   ```sh
   git clone https://github.com/your_username/RealTime-map.git
   cd RealTime-map
   ```

2. **Создайте файл конфигурации окружения**
   В корневой директории проекта скопируйте пример файла окружения. Этот файл содержит все необходимые переменные конфигурации для сервисов приложения.
   ```sh
   cp .env.example .env
   ```

3. **Настройте окружение**
   Откройте созданный файл `.env` в текстовом редакторе. Вам нужно настроить имена хостов для базы данных и Redis в соответствии с именами сервисов в вашем файле `docker-compose.yml`.

   > **Важно:** При запуске в Docker Compose сервисы общаются используя имена сервисов, а не `localhost`.
   Например, если ваш сервис PostgreSQL называется `db` в `docker-compose.yml`, то хост в URL подключения должен быть `db`.

   Пример конфигурации при условии, что сервисы называются `db` и `redis`:

   ```env
   # .env

   # DATABASE (Connect to the 'db' service in Docker)
   APP_CONFIG__DB__URL=postgresql+asyncpg://postgres:admin@db:5432/Postgres
   APP_CONFIG__DB__ECHO=0
   APP_CONFIG__DB__ECHO_POOL=0
   APP_CONFIG__DB__MAX_OVERFLOW=10
   APP_CONFIG__DB__POOL_SIZE=10

   # SERVER
   APP_CONFIG__SERVER__HOST=0.0.0.0
   APP_CONFIG__SERVER__PORT=8001
   APP_CONFIG__SERVER__TIMEOUT=900
   APP_CONFIG__SERVER__WORKERS=4
   APP_CONFIG__SERVER__DOMAINS=*

   # REDIS (Connect to the 'redis' service in Docker)
   APP_CONFIG__REDIS__URL=redis://redis
   APP_CONFIG__REDIS__PREFIX=cache_prefix

   # CELERY (Uses the 'redis' service as broker and backend)
   APP_CONFIG__CELERY__BROKER=redis://redis
   APP_CONFIG__CELERY__BACKEND=redis://redis

   # SOCKET
   APP_CONFIG__SOCKET__USERNAME=admin
   APP_CONFIG__SOCKET__PASSWORD=admin

   # PAYMENT
   APP_CONFIG__PAYMENT__SECRET_KEY=secret_key
   APP_CONFIG__PAYMENT__SHOP_ID=shop_id
   ```

### Запуск приложения

После настройки файла `.env` вы можете запустить все сервисы одной командой из корневой директории проекта:

```sh
docker-compose up -d --build
```

* `--build`: Пересобирает образы, если Dockerfile или исходный код изменились
* `-d`: Запускает контейнеры в фоновом режиме

API будет доступен по адресу http://localhost:8001.

Для просмотра автоматически сгенерированной интерактивной документации перейдите по ссылкам:

* **Swagger UI:** http://localhost:8001/docs
* **ReDoc:** http://localhost:8001/redoc